<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: App.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: App.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, { Component } from 'react';
import {
  HashRouter,
  Route,
  Switch,
} from 'react-router-dom';
import { Helmet } from 'react-helmet';

import { Confirmer } from './utils/getUserConfirmation';

// CUSTOM COMPONENTS
import HomePage from './containers/HomePage';
import AboutPage from './containers/AboutPage';
import VisitPage from './containers/VisitPage';
import Footer from './components/Footer';
import Header from './components/Header';
// sort of a component
import { renderIfTrue } from './components/renderIfTrue';

// Development HUD
import { DevSwitch } from './containers/DevSwitch';
import { DevHud } from './components/dev/DevHud';

// Object Manipulation
import { cloneDeep } from 'lodash';
import { CLIENT_DEFAULTS } from './utils/CLIENT_DEFAULTS';

// LOCALIZATION
import { getTextForLanguage } from './utils/getTextForLanguage';

/**
 * Main top-level component of the app. Contains the router that controls access
 * to the {@link HomePage}, {@link VisitPage}, and {@link AboutPage}, as well
 * as providing the common {@link Header} and {@link Footer} to these pages.
 * It also manages the {@link DevHud}, which provides debugging and analysis
 * options for developers.
 *
 * You can change the HashRouter tags (below if you are viewing this comment in
 * the source code) to Router tags to turn off hash routing. Hash routing is
 * only used to be compatible with GitHub Pages.
 *
 * Sends in the initial client values from {@link CLIENT_DEFAULTS} to
 * {@link VisitPage}.
 *
 * @extends React.Component
 */
class App extends Component {
  constructor (props) {
    super(props);

    var defaults = cloneDeep(CLIENT_DEFAULTS);

    // Development variables are the only things stored
    var localDev = localStorage.getItem(`cliffEffectsDevProps`);
    if (typeof localDev !== `string`) {
      localDev = {};
    } else {
      localDev = JSON.parse(localDev);
    }

    /**
     *  React state.
     *  @property {string} langCode - [ISO 639-1 code]{@link https://en.wikipedia.org/wiki/List_of_ISO_639-1_codes} of currently selected language
     *  @property {object} snippets - text snippets in the current language (output of {@link getTextForLanguage})
     *  @property {object} clients  - sets of client data to keep track of:
     *  @property {object} clients.default - default set, never changes
     *  @property {object} clients.loaded  - set that has been loaded using the dev HUD
     *  @property {object} devProps - dev HUD settings. They get added as classes to the div that encloses the whole app. May want to rethink.
     *  @property {boolean} devProps.dev - whether dev HUD is turned on
     *  @property {boolean} devProps.english - whether to highlight English snippets
     *  @property {boolean} devProps.nonEnglish - whether to highlight snippets in the current language, if that language is not English
     *  @property {boolean} termsAccepted - displays modal to accept terms before allowing user to fill out form
     */
    this.state = {
      langCode: `en`,
      snippets: getTextForLanguage(`en`),
      clients:  {
        default: defaults,
        loaded:  defaults,
      },
      // All these should be bools. For now, at least.
      // They get added as classes. May want to rethink.
      devProps: {
        dev:        false,
        devHidden:  false,
        english:    true,
        nonEnglish: true,
        warningOff: true,
        ...localDev,
      },
      termsAccepted: false,
    };
  };  // End constructor()

  /**
   * Set the human language of the app (i.e. the language in which the UI will
   * display text for users to read, NOT the coding language).
   * @method
   * @param {object} evnt - The event object from an input that uses this event handler (not used)
   * @param {object} inputProps - An object representing the properties of the Semantic UI React input component which triggered the language change.
   * @param {string} inputProps.value - the [ISO 639-1 code]{@link https://en.wikipedia.org/wiki/List_of_ISO_639-1_codes} for the newly selected language.
  */
  setLanguage = (evnt, inputProps) => {
    var snippets = getTextForLanguage(inputProps.value);
    this.setState({ language: inputProps.value, snippets: snippets });
  };

  /** Set the value of a specified key in the app state's devProps.
   * These keys should only be set to boolean values (@todo enforce only allowing boolean values?).
   * Keys with a value of true are added as classes to the app's main element when it is rendered.
   * @method
   * @param {string} key - The key whose value is to be changed in the app state's devProps
   * @param {boolean} value - The value to be set for the given key in the app state's devProps
   */
  setDev = (key, value) => {
    this.setState((prevState) => {

      var props = prevState.devProps;
      if (props[ key ] !== value) {

        var newProps = { ...props, [ key ]: value };
        localStorage.setItem(`cliffEffectsDevProps`, JSON.stringify(newProps));

        return { devProps: newProps };
      }
    });
  };  // End setDev()

  /** Load an individual client's data. Currently, the only source of client
   * data to load is a text input field in the Dev HUD.
   * @method
   * @param {object} params
   * @param {object} params.toLoad - A JSON object representing the client data
   * to be loaded. Must match the client data format (See
   * {@link CLIENT_DEFAULTS} for an example of the correct client data format)
   */
  loadClient = ({ toLoad }) => {
    this.setState((prevState) => {

      const clients  = cloneDeep(prevState.clients),
            defaults = cloneDeep(clients.default),
            newData  = Object.assign(defaults, toLoad);

      return { clients: { ...clients, loaded: newData }};
    });
  };  // End loadClient()

  /** Concatenate the true boolean values in input object to a space-delimited
   * string, for use as a CSS class string. Currently used to convert
   * [devProps]{@link App#state} to classes for the rendered `div`.
   * @method
   * @param {object} obj - the object to be converted to a string
   * @returns {string} a string constructed by concatenating together the keys
   * of obj with values equal to true, separated by spaces.
   */
  propsToClasses (obj) {
    var classes = ``;
    for (let key in obj) {
      if (obj[ key ] === true) {
        classes += ` ` + key;
      }
    }
    return classes;
  };  // End propsToClasses()

  /** Toggles termsAccepted flag in app state.  Passed to PredictionsWarning modal
   * which calls this in the onClose handler.  App is unavailable until terms 
   * are accepted unless warningOff is set to true in DevHud.
   * @method
   */
  toggleAcceptTerms = () => {
    let isAccepted = this.state.termsAccepted;
    this.setState({ termsAccepted: !isAccepted });
  };  // End acceptTerms()

  render () {
    var {
      langCode,
      snippets,
      devProps,
      clients,
      termsAccepted,
    } = this.state;

    var { warningOff } = devProps;

    var confirmer = new Confirmer(),  // Makes sure user doesn't accidentally lose work
        classes   = this.propsToClasses(devProps),
        devFuncs  = {
          setDev:      this.setDev,
          loadClient:  this.loadClient,
          setLanguage: this.setLanguage,
        },
        funcs      = { toggleAcceptTerms: this.toggleAcceptTerms },
        clientData = clients.loaded;

    return (
      &lt;div
        id = { `App` }
        className = { classes }>
        &lt;Helmet>
          &lt;html lang={ langCode } />
        &lt;/Helmet>

        &lt;HashRouter getUserConfirmation={ confirmer.getConfirmation }>
          &lt;div id='HashRouter'>
            &lt;Route
              path="/:rest+"
              component={ (props) => {
                return (
                  &lt;Header
                    { ...props }
                    snippets={{ ...snippets.header, langCode: snippets.langCode }} />);
              } } />

            &lt;Switch>
              &lt;Route
                exact
                path="/"
                component={ (props) => {
                  return (
                    &lt;HomePage
                      { ...props }
                      snippets={{ ...snippets.homePage, langCode: snippets.langCode }} />);
                } } />
              &lt;Route
                path="/about"
                component={ (props) => {
                  return (
                    &lt;AboutPage
                      { ...props }
                      snippets={{ ...snippets.aboutPage, langCode: snippets.langCode }} />);
                } } />
              &lt;Route
                path="/visit/:clientId/:visitId"
                component={ (props) => {
                  return (
                    &lt;VisitPage
                      { ...props }
                      termsAccepted = { termsAccepted || warningOff }
                      funcs         = { funcs }
                      confirmer     = { confirmer }
                      snippets      = {{ ...snippets.visitPage, langCode: snippets.langCode }}
                      clientData    = { clientData } />);
                } } />

              {/* For managing our development HUD */}
              &lt;Route
                path = { `/dev` }
                component={ (props) => { return (
                  &lt;DevSwitch
                    { ...props }
                    setDev   = { this.setDev }
                    devProps = { devProps } />
                );} } />
            &lt;/Switch>

          &lt;/div>
        &lt;/HashRouter>
        &lt;Footer snippets={{ ...snippets.footer, langCode: snippets.langCode }} />

        { renderIfTrue(devProps.dev === true, (
          &lt;DevHud
            devProps = { devProps }
            funcs    = { devFuncs }
            data     = {{ default: clients.default }}
            state    = { this.state } />
        ))}
      &lt;/div>
    );
  };  // End render()
}


export default App;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-formHelpers.html">formHelpers</a></li><li><a href="module-utils_cashflow.html">utils/cashflow</a></li><li><a href="module-utils_convert-by-timescale.html">utils/convert-by-timescale</a></li><li><a href="module-utils_getGovData.html">utils/getGovData</a></li><li><a href="module-utils_getMembers.html">utils/getMembers</a></li><li><a href="module-utils_getSideEffects.html">utils/getSideEffects</a></li><li><a href="module-utils_getTextForLanguage.html">utils/getTextForLanguage</a></li><li><a href="module-utils_getTimeFrames.html">utils/getTimeFrames</a></li><li><a href="module-utils_interpolation.html">utils/interpolation</a></li><li><a href="module-utils_math.html">utils/math</a></li><li><a href="module-utils_objectKeyPaths.html">utils/objectKeyPaths</a></li><li><a href="module-utils_setNestedProperty.html">utils/setNestedProperty</a></li><li><a href="module-utils_validators.html">utils/validators</a></li><li><a href="module-utils_valueFixers.html">utils/valueFixers</a></li></ul><h3>Classes</h3><ul><li><a href="App.html">App</a></li><li><a href="AskPermission.html">AskPermission</a></li><li><a href="BrowserLeaveListener.html">BrowserLeaveListener</a></li><li><a href="CashFlowInputsRow.html">CashFlowInputsRow</a></li><li><a href="Confirmer.html">Confirmer</a></li><li><a href="ControlledRadioYesNo.html">ControlledRadioYesNo</a></li><li><a href="CustomClient.html">CustomClient</a></li><li><a href="ErrorListener.html">ErrorListener</a></li><li><a href="FeedbackPrompt.html">FeedbackPrompt</a></li><li><a href="HeadingWithDetail.html">HeadingWithDetail</a></li><li><a href="ManagedNumberField.html">ManagedNumberField</a></li><li><a href="ReactRouterLeaveListener.html">ReactRouterLeaveListener</a></li><li><a href="RowWithDetail.html">RowWithDetail</a></li><li><a href="ShowOnYes.html">ShowOnYes</a></li><li><a href="TermsAndConditions.html">TermsAndConditions</a></li><li><a href="VerticalLine.html">VerticalLine</a></li></ul><h3>Namespaces</h3><ul><li><a href="SNAPhelpers.html">SNAPhelpers</a></li></ul><h3>Global</h3><ul><li><a href="global.html#applyAndPushBenefits">applyAndPushBenefits</a></li><li><a href="global.html#BottomRowButton">BottomRowButton</a></li><li><a href="global.html#CashFlowContainer">CashFlowContainer</a></li><li><a href="global.html#CashFlowDisplayRow">CashFlowDisplayRow</a></li><li><a href="global.html#CLIENT_DEFAULTS">CLIENT_DEFAULTS</a></li><li><a href="global.html#ColumnHeading">ColumnHeading</a></li><li><a href="global.html#ContentH1">ContentH1</a></li><li><a href="global.html#ContentSubH1">ContentSubH1</a></li><li><a href="global.html#CurrentBenefitsContent">CurrentBenefitsContent</a></li><li><a href="global.html#CurrentBenefitsStep">CurrentBenefitsStep</a></li><li><a href="global.html#CurrentExpensesStep">CurrentExpensesStep</a></li><li><a href="global.html#CurrentIncomeStep">CurrentIncomeStep</a></li><li><a href="global.html#DevMenu">DevMenu</a></li><li><a href="global.html#EarnedFrom">EarnedFrom</a></li><li><a href="global.html#ExpensesFormContent">ExpensesFormContent</a></li><li><a href="global.html#ExternalLink">ExternalLink</a></li><li><a href="global.html#FormPartsContainer">FormPartsContainer</a></li><li><a href="global.html#getBenefitData">getBenefitData</a></li><li><a href="global.html#getChartData">getChartData</a></li><li><a href="global.html#getSection8Benefit">getSection8Benefit</a></li><li><a href="global.html#getSNAPBenefits">getSNAPBenefits</a></li><li><a href="global.html#Housing">Housing</a></li><li><a href="global.html#IncomeForm">IncomeForm</a></li><li><a href="global.html#inlineComponents">inlineComponents</a></li><li><a href="global.html#IntervalColumnHeadings">IntervalColumnHeadings</a></li><li><a href="global.html#localizations">localizations</a></li><li><a href="global.html#maximum_value_yearly">maximum_value_yearly</a></li><li><a href="global.html#MonthlyCashFlowRow">MonthlyCashFlowRow</a></li><li><a href="global.html#round$">round$</a></li><li><a href="global.html#sampleClients">sampleClients</a></li><li><a href="global.html#SpaceHolder">SpaceHolder</a></li><li><a href="global.html#StackedBarGraph">StackedBarGraph</a></li><li><a href="global.html#Summary">Summary</a></li><li><a href="global.html#toMoneyStr">toMoneyStr</a></li><li><a href="global.html#totalLastItemsOfArraysInObject">totalLastItemsOfArraysInObject</a></li><li><a href="global.html#undefinedString">undefinedString</a></li><li><a href="global.html#UNDER13_NON_TRANSPORT_CARE">UNDER13_NON_TRANSPORT_CARE</a></li><li><a href="global.html#UNEARNED_INCOME_SOURCES">UNEARNED_INCOME_SOURCES</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Fri Oct 19 2018 10:24:48 GMT-0400 (EDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
